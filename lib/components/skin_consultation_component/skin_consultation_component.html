<h1>{{msg.skin_consultation(1)}}</h1>
<material-expansionpanel-set *ngIf="step < 5">
  <material-expansionpanel *ngIf="customer.id == null"
                           [name]="msg.details()"
                           [showSaveCancel]="false"
                           [expanded]="step == 0"
                           (open)="step = 0">
    <div class="row">
      <div class="col">
        <bo-button-cloud-single-select [label]="msg.gender()"
                                       [options]="genderOptions"
                                       [centerLabel]="true"
                                       [(ngModel)]="customer.sex"></bo-button-cloud-single-select>
      </div>
    </div>
    <div class="row">
      <div class="l4 m3 s0 col"></div>
      <div class="l4 m6 col">
        <fo-social-number-input [(value)]="customer.social_number"></fo-social-number-input>              
      </div>
      <div class="l4 m3 s0 col"></div>
    </div>
    <div class="row">
      <div class="col text-center">
        <p class="margin-bottom-small">{{msg.consultation_gdpr_terms()}}, {{msg.read_more()}}:
          <a href="https://gdpr.dahlskincare.com"
             target="_blank">https://gdpr.dahlskincare.com</a>.
        </p>
        <material-checkbox [(checked)]="termsAccepted"
                           [label]="msg.i_accept_the_terms()"></material-checkbox>
      </div>
    </div>
    <div class="row margin-top-medium">
      <div class="col text-center">
        <material-fab mini
                      [disabled]="customerService.loading || customer.social_number == null || customer.sex == null || !termsAccepted"
                      (trigger)="onCreateCustomer()">
          <material-icon *ngIf="!customerService.loading"
                         icon="keyboard_arrow_down"
                         size="x-large"></material-icon>
          <material-icon *ngIf="customerService.loading"
                         icon="hourglass_empty"
                         size="x-large"></material-icon>
        </material-fab>
      </div>
    </div>
  </material-expansionpanel>
  <material-expansionpanel name="{{msg.problem_areas()}}"
                           [showSaveCancel]="false"
                           [disabled]="step < 1"
                           [expanded]="step == 1"
                           (open)="step = 1">
    <bo-consultation-problem-areas [model]="consultation"
                                   [customer]="customer"></bo-consultation-problem-areas>
    <div class="row">
      <div class="col text-center">
        <material-button clear-size
                         [disabled]="consultation.area_face == false && consultation.area_chest == false && consultation.area_back == false && consultation.area_other == false || (consultation.area_face == true && consultation.zones.isEmpty)"
      
                         (trigger)="step = 2">
          <material-icon icon="keyboard_arrow_down"
                         size="x-large"></material-icon>
        </material-button>
      </div>
    </div>
  </material-expansionpanel>
  <material-expansionpanel name="{{msg.symptoms()}}"
                           [showSaveCancel]="false"
                           [disabled]="step < 2"
                           [expanded]="step == 2"
                           (open)="step = 2">
    <bo-consultation-symptoms [model]="consultation"></bo-consultation-symptoms>
    <div class="row margin-top-medium">
      <div class="col text-center">
        <material-fab mini
                      [disabled]="consultation.customer_symptoms.isEmpty"
                      (trigger)="step = 3">
          <material-icon icon="keyboard_arrow_down"
                         size="x-large"></material-icon>
        </material-fab>
      </div>
    </div>
  </material-expansionpanel>
  <material-expansionpanel name="{{msg.photos()}}"
                           [showSaveCancel]="false"
                           [disabled]="step < 3"
                           [expanded]="step == 3"
                           (open)="step = 3">
    <bo-consultation-pictures [model]="consultation"
                              [customer]="customer"
                              #pictures></bo-consultation-pictures>
    <div class="row margin-top-medium">
      <div class="col text-center">
        <material-fab mini
                      [disabled]="consultation.current_skin_status == null || consultation.skin_tone_id == null"
                      (trigger)="step = 4">
          <material-icon icon="keyboard_arrow_down"
                         size="x-large"></material-icon>
        </material-fab>
      </div>
    </div>
  </material-expansionpanel>
  <material-expansionpanel name="{{msg.contact()}}"
                           [showSaveCancel]="false"
                           [disabled]="step < 4"
                           [expanded]="step == 4"
                           (open)="step = 4">
    <form [ngFormModel]="form">
      <div class="row">
        <div class="m4 col">
          <material-input label="{{msg.email()}}*"
                          floatingLabel
                          [disabled]="customerService.loading || consultationService.loading"
                          [maxCount]="128"
                          [ngFormControl]="form.controls['email']"
                          (blur)="onEmailBlur()"
                          [(ngModel)]="customer.email"></material-input>
        </div>
      </div>
      <div class="row">
        <div class="m4 col">
          <material-input label="{{msg.firstname()}}*"
                          floatingLabel
                          [disabled]="customerService.loading || consultationService.loading"
                          [maxCount]="64"
                          [ngFormControl]="form.controls['firstname']"
                          [(ngModel)]="customer.firstname"></material-input>
        </div>
        <div class="m4 col">
          <material-input label="{{msg.lastname()}}*"
                          floatingLabel
                          [disabled]="customerService.loading || consultationService.loading"
                          [maxCount]="64"
                          [ngFormControl]="form.controls['lastname']"
                          [(ngModel)]="customer.lastname"></material-input>
        </div>
      </div>
      <div class="row collapse">
        <div class="col">
          <material-checkbox label="{{msg.call_me()}}"
                             [disabled]="customerService.loading || consultationService.loading"
                             [checked]="consultation.call_me"
                             (checkedChange)="onCallMeChange($event)">
          </material-checkbox>
        </div>
      </div>
      <div class="row"
           *ngIf="consultation.call_me">
        <div class="l1 m2 s4 col">
          <fo-select [label]="msg.country_code()"
                     [disabled]="customerService.loading || consultationService.loading"
                     [options]="countryCodeOptions"
                     [(selectedId)]="customer.phone_country">
          </fo-select>
        </div>
        <div class="m3 s8 col">
          <material-input label="{{msg.phone()}}*"
                          floatingLabel
                          [disabled]="customerService.loading || consultationService.loading"
                          [maxCount]="64"
                          [ngFormControl]="form.controls['phone']"
                          [(ngModel)]="customer.phone"></material-input>
        </div>
      </div>
    </form>
    <div class="row margin-top-medium">
      <div class="col text-center">
        <material-button clear-size
                         [disabled]="!form.valid || consultationService.loading || customerService.loading || customer.consultation_id != null"
      
                         (trigger)="onCreateConsultation()">
          <span *ngIf="!consultationService.loading && !customerService.loading">{{msg.submit()}}</span>
          <material-icon *ngIf="consultationService.loading || customerService.loading"
                         icon="hourglass_empty"
                         baseline
                         size="x-large"></material-icon>
        </material-button>
      </div>
    </div>
  </material-expansionpanel>
</material-expansionpanel-set>

<fo-modal title="{{msg.thank_you()}}!"
          [whiteHeader]="true"
          [smallPadding]="false"
          [visible]="step == 5"
          (visibleChange)="step = 6">
  <div class="row">
    <div class="col">
      <p innerHtml="{{msg.consultation_done_text()}}"></p>
    </div>
  </div>
  <div class="text-right"
       footer>
    <material-button raised
                     (trigger)="step = 6">
      OK
    </material-button>
  </div>
</fo-modal>

<div *ngIf="step == 6">
  <bo-consultation-survey [model]="consultation"
                          [customer]="customer"
                          (done)="onSurveyDone($event)"></bo-consultation-survey>
</div>

<div class="row"
     *ngIf="step > 6">
  <div class="col">
    <p innerHtml="{{msg.consultation_survey_done_text()}}"></p>
  </div>
</div>

<fo-modal title="{{msg.error_occured()}}"
          [(visible)]="errorModalVisible"
          [whiteHeader]="true"
          [smallPadding]="false">
  <div class="row">
    <div class="col">
      <p innerHtml="{{msg.error_customer_already_has_consultation()}}">
      </p>
    </div>
  </div>
</fo-modal>